<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ZenTrader Pro</title>
<style>
:root{
  --bg:#000; --card:#0f172a; --text:#e5e7eb; --muted:#94a3b8; --accent:#16a34a;
  --good:#22c55e; --bad:#ef4444; --headerHpx:120px; --controlsHpx:64px;
}
*{box-sizing:border-box}
html{scroll-behavior:smooth;scroll-padding-top:calc(var(--headerHpx) + var(--controlsHpx) + 16px)}
body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
/* Chrome-required banner */
.topwarn{display:none;position:fixed;top:0;left:0;right:0;z-index:70;background:#7c2d12;color:#fff;border-bottom:1px solid #78350f}
.topwarn .inner{max-width:1100px;margin:0 auto;padding:10px 16px;display:flex;gap:10px;align-items:center;justify-content:space-between}
.topwarn button{background:#111827;border:1px solid #f59e0b;color:#fff;border-radius:999px;padding:6px 10px;cursor:pointer}
/* Header */
.banner{position:fixed;top:0;left:0;right:0;height:var(--headerHpx);z-index:60;display:flex;align-items:center;justify-content:center;background:#000;border-bottom:1px solid #111827;box-shadow:0 10px 30px rgba(0,0,0,.35)}
.brandwrap{display:flex;align-items:center;gap:14px}
.yinyang{width:56px;height:56px;border-radius:50%;
  background:radial-gradient(circle at 50% 25%,#000 0 9px,#fff 10px 50%),
             radial-gradient(circle at 50% 75%,#fff 0 9px,#000 10px 50%),
             linear-gradient(90deg,#000 50%,#fff 0);
  box-shadow:0 6px 18px rgba(255,255,255,.08)}
.title{font-size:40px;font-weight:800;letter-spacing:.4px;color:#fff;text-shadow:0 2px 12px rgba(0,0,0,.6)}
/* Controls (fixed) */
header.controls{
  position:fixed; top:var(--headerHpx); left:0; right:0; z-index:50;
  display:flex;flex-wrap:wrap;align-items:center;gap:10px;justify-content:space-between;
  padding:10px 16px;background:rgba(15,23,42,.94);
  backdrop-filter:blur(6px);border-bottom:1px solid #1f2937;
  box-shadow:0 6px 14px rgba(0,0,0,.35)
}
.pill{display:inline-flex;align-items:center;gap:6px;border:1px solid #334155;background:#0b1220;color:#cbd5e1;border-radius:999px;padding:6px 10px;font-size:12px}
button{background:var(--accent);color:#fff;border:none;border-radius:10px;padding:10px 14px;cursor:pointer}
button.ghost{background:#0b1220;color:#fff;border:1px solid #374151}
button.danger{background:#ef4444}
button[disabled]{opacity:.6;cursor:not-allowed}
select,input{background:#0b1220;color:#e5e7eb;border:1px solid #374151;border-radius:10px;padding:10px}
/* Spacer that reserves room for fixed header + controls */
#topShim{height:0}
/* Body */
.wrap{max-width:1100px;margin:8px auto 18px auto;padding:0 16px}
.grid{display:grid;grid-template-columns:1.2fr .8fr;gap:16px}
.card{background:var(--card);border:1px solid #1f2937;border-radius:14px;padding:14px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
h2{margin:6px 0 12px 0;color:#d1fae5}
label{font-size:12px;color:var(--muted)}
.row{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.row-3{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.row-2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.actions{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
pre{background:#0b1220;border:1px dashed #374151;border-radius:10px;padding:10px;max-height:160px;overflow:auto}
.dot{width:10px;height:10px;border-radius:50%;background:#6b7280;border:1px solid #374151}
.dot.live{background:#22c55e}
.pillstat{display:inline-block;padding:2px 8px;border-radius:999px;font-size:11px;border:1px solid #374151;background:#0b1220;color:#e5e7eb}
.pillstat.good{border-color:#14532d;color:#86efac;background:#052e16}
canvas{background:#0b1220;border:1px solid #1f2937;border-radius:12px;padding:8px}
.chips{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
.chip{border:1px solid #334155;background:#0b1220;color:#cbd5e1;border-radius:999px;padding:4px 8px;font-size:12px}
.chip.ok{border-color:#14532d;color:#86efac;background:#052e16}
.footerVer{opacity:.6;font-size:12px;text-align:right;margin-top:6px}
@media(max-width:980px){.grid{grid-template-columns:1fr}.title{font-size:36px}}
</style>
</head>
<body>

<!-- Chrome warning banner -->
<div class="topwarn" id="browserWarn">
  <div class="inner">
    <div>‚ö†Ô∏è Voice features require the <strong>Chrome</strong> browser (or Microsoft Edge). Please open this site in Chrome for full functionality.</div>
    <button id="dismissWarn">Dismiss</button>
  </div>
</div>

<!-- Header -->
<div class="banner">
  <div class="brandwrap">
    <div class="yinyang" aria-hidden="true"></div>
    <div class="title">ZenTrader Pro</div>
  </div>
</div>

<!-- Controls -->
<header class="controls">
  <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
    <label class="pill" title="Per-side commission ($)">
      Per-side $ <input id="gcRateInput" type="number" step="0.01" style="width:90px;background:transparent;border:none;color:#e5e7eb" />
    </label>
    <label class="pill" title="Auto commission = per-side * 2 * qty">
      <input type="checkbox" id="gcAutoToggle" checked> Auto-apply commission
    </label>
  </div>
  <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
    <select id="rangeSelect">
      <option value="all">All</option><option value="day">Daily</option>
      <option value="week">Weekly</option><option value="month">Monthly</option>
      <option value="year">Yearly</option>
    </select>
    <button class="ghost" id="exportBtn">Export CSV</button>
    <label class="pill"><input type="file" id="importFile" accept=".csv" style="display:none"><span id="importBtn" style="cursor:pointer">Import CSV</span></label>
    <select id="lang">
      <option value="en-US" selected>English (US)</option>
      <option value="en-GB">English (UK)</option><option value="en-CA">English (CA)</option>
      <option value="en-AU">English (AU)</option>
    </select>
    <button id="primeMicBtn" class="ghost" title="Grant mic permission">Prime Mic</button>
    <button id="voiceBtn" title="Use Chrome/Edge for voice">üé§ Voice</button><span class="dot" id="voiceDot" title="mic status"></span>
    <label class="pill"><input type="checkbox" id="keepAlive" checked> Keep mic alive</label>
    <label class="pill"><input type="checkbox" id="liveFill" checked> Live fill</label>
    <span class="pill" id="envPill">env: ?</span>
    <label class="pill"><input type="checkbox" id="ttsToggle" checked> üîà Speak on review & save</label>
    <span class="pill">ZTP v3.5</span>
  </div>
</header>

<!-- Spacer so content sits below fixed bars -->
<div id="topShim" aria-hidden="true"></div>

<!-- Main -->
<div class="wrap">
  <div class="grid">
    <div class="card">
      <h2>Add / Edit Trade</h2>
      <div class="row-3">
        <div><label>Date</label><input type="date" id="date"></div>
        <div><label>Symbol</label><input id="symbol" placeholder="ES, NQ, AAPL"></div>
        <div><label>Direction</label><select id="direction"><option>Long</option><option>Short</option></select></div>
      </div>
      <div class="row">
        <div><label>Qty</label><input id="qty" type="number" value="1" step="1" min="1"></div>
        <div><label>Entry Price</label><input id="entry" type="number" step="0.01" placeholder="5000"></div>
        <div><label>Exit Price</label><input id="exit" type="number" step="0.01" placeholder="5010"></div>
        <div><label>Commission ($ total)</label><input id="commission" type="number" step="0.01" value=""></div>
      </div>
      <div class="row-3">
        <div><label>Entry Time</label><input id="entryTime" type="time" placeholder="09:35"></div>
        <div><label>Exit Time</label><input id="exitTime" type="time" placeholder="10:12"></div>
        <div><label>Duration (min)</label><input id="duration" type="number" step="1" placeholder="auto"></div>
      </div>
      <div class="chips" id="chipBar"></div>
      <div class="actions">
        <button id="addBtn">Add trade</button>
        <button class="ghost" id="clearFormBtn">Clear form</button>
        <button class="danger" id="wipeBtn">Wipe all</button>
      </div>
      <div style="margin-top:8px;color:#93c5fd">
        Engine: <span id="vEngine">?</span> ‚Äî Status: <span id="vStatus">idle</span> ‚Äî
        <span id="vNote">Say: ‚Äúsymbol ES, long, qty 1, entry 5000, exit 5010, date today ‚Ä¶ review ‚Ä¶ confirm‚Äù.</span>
      </div>
      <pre id="vLog" style="margin-top:8px"></pre>
    </div>

    <div class="card">
      <h2>KPIs</h2>
      <div class="row-2">
        <div class="card" style="background:#0b1220"><div class="muted">Net P&L</div><div id="kNet" style="font-size:22px;"></div></div>
        <div class="card" style="background:#0b1220"><div class="muted">Win %</div><div id="kWin" style="font-size:22px;"></div></div>
      </div>
      <div class="row-2" style="margin-top:8px">
        <div class="card" style="background:#0b1220"><div class="muted">Avg Profit (Winners)</div><div id="kAvgWin" style="font-size:22px;"></div></div>
        <div class="card" style="background:#0b1220"><div class="muted">Cum. Commissions</div><div id="kComm" style="font-size:22px;"></div></div>
      </div>
    </div>
  </div>

  <div class="card">
    <h2>Profit Tracker ‚Äî P&L Trend</h2>
    <div class="row-2">
      <select id="granSelect">
        <option value="day">Daily</option><option value="week">Weekly</option>
        <option value="month">Monthly</option><option value="year">Yearly</option>
      </select>
      <select id="metricSelect">
        <option value="net">Net P&L</option>
        <option value="gross">Gross P&L</option>
        <option value="commission">Commissions</option>
      </select>
    </div>
    <canvas id="plChart" height="180"></canvas>
  </div>

  <div class="card">
    <h2>Commissions Over Time</h2>
    <canvas id="commChart" height="180"></canvas>
  </div>
  <div class="footerVer">ZTP v3.5</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// ===== Layout: measure bars, set spacer, keep it correct on changes =====
(function layoutGuard(){
  function setOffsets(){
    const warn = document.getElementById('browserWarn');
    const header = document.querySelector('.banner');
    const controls = document.querySelector('header.controls');
    const shim = document.getElementById('topShim');
    const wrap = document.querySelector('.wrap');
    if(!header || !controls || !
	

	

	
