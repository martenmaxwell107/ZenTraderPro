<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ZenTrader Pro ‚Äî Dashboard</title>
<meta name="color-scheme" content="dark light"/>
<meta name="theme-color" content="#0b0f17"/>
<style>
  :root{
    --bg:#0b0f17; --panel:#111827; --panel-2:#0e1524;
    --border:#22314a; --text:#e8eef7; --muted:#9db0c8;
    --gold:#d4af37; --gold2:#b88a1c; --gold3:#7a5e12; --gold-lite:#ffe08a;
    --accent:#4cc9f0; --green:#3fb37f; --red:#d45b6b;
  }
  *,*::before,*::after{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
    color:var(--text);
    background:radial-gradient(900px 540px at 50% -180px,#182235 10%,var(--bg) 60%);
    padding-top:160px; /* will be adjusted by JS */
  }

  /* Splash (login) */
  .splash{position:fixed;inset:0;display:grid;place-items:center;z-index:2000;
    background:radial-gradient(1000px 700px at 40% -300px,#1a2740 0%,#0b0f17 60%);
    transition:opacity .35s ease}
  .splash.hidden{opacity:0;pointer-events:none}
  .splash-card{
    width:min(720px,92vw);
    background:linear-gradient(180deg,#121a2b,#0e1524);
    border:1px solid var(--border);
    border-radius:18px; padding:24px;
    box-shadow:0 20px 80px rgba(0,0,0,.45), inset 0 0 60px rgba(212,175,55,.06);
    text-align:center;
  }
  .btn{
    background:#0e1524; border:1px solid var(--border); color:var(--text);
    padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600;
  }
  .btn:hover{border-color:#3c5f94}
  select{
    background:#0e1524; color:var(--text); border:1px solid var(--border);
    border-radius:10px; padding:8px 10px;
  }

  /* Sticky header */
  header.brand{
    position:fixed; left:0; right:0; top:0; z-index:1000;
    backdrop-filter:saturate(130%) blur(4px);
    background:linear-gradient(180deg,rgba(16,24,39,.95),rgba(11,15,23,.92));
    border-bottom:1px solid var(--border);
    padding:12px 16px 10px;
  }
  .brand-inner{max-width:1200px;margin:0 auto;display:grid;place-items:center}
  .brand-title{margin:8px 0 0;font-weight:900;letter-spacing:.35px;font-size:22px;color:var(--gold-lite);text-shadow:0 1px 0 #7a5e12}
  .brand-sub{margin:2px 0 0;color:var(--muted);font-size:12px}
  .voice{display:flex;gap:10px;align-items:center;justify-content:center;margin:10px 0 0;flex-wrap:wrap}
  .status{color:var(--muted);font-size:12px}

  /* Layout */
  main{max-width:1200px;margin:18px auto;padding:0 16px 60px;display:grid;gap:16px;grid-template-columns:2fr 1fr}
  @media (max-width:980px){main{grid-template-columns:1fr}}
  .card{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:16px;box-shadow:0 2px 18px rgba(0,0,0,.25)}
  .card h2{margin:0 0 12px;font-size:16px;color:var(--gold-lite)}
  .gold-outline{border:1px solid rgba(212,175,55,.35);box-shadow:inset 0 0 12px rgba(212,175,55,.15)}
  .form-grid{display:grid;grid-template-columns:140px 1fr;gap:12px;align-items:center}
  label{color:var(--muted);font-size:13px}
  input,select,textarea{
    width:100%;background:var(--panel-2);color:var(--text);
    border:1px solid #283853;border-radius:10px;padding:10px;font-size:14px;outline:none;
    transition:border-color .2s,box-shadow .2s
  }
  input:focus,select:focus,textarea:focus{border-color:#3c5f94;box-shadow:0 0 0 3px rgba(76,201,240,.12)}
  textarea{min-height:80px;resize:vertical}
  table{width:100%;border-collapse:collapse}
  th,td{border:1px solid var(--border);padding:8px 10px;text-align:left}
  th{background:var(--panel-2);color:var(--gold-lite);font-weight:700}
  .stats{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  .stat{background:var(--panel-2);border:1px solid var(--border);border-radius:12px;padding:12px;text-align:center}
  .stat .v{font-size:20px;font-weight:800}
  .stat .l{color:var(--muted);font-size:12px}
  .chart{background:var(--panel-2);border:1px solid var(--border);border-radius:12px;padding:14px;display:grid;place-items:center}
  canvas{width:100%;height:260px;max-height:42vh}
  footer{color:var(--muted);font-size:12px;text-align:center;padding:24px 0}
</style>
<link id="favicon" rel="icon" type="image/svg+xml" href="">
</head>
<body>

<!-- Splash / Login -->
<div id="splash" class="splash" role="dialog" aria-modal="true">
  <div class="splash-card">
    <div id="splashLogo" style="display:grid;place-items:center;margin-bottom:10px"></div>
    <h1 style="color:var(--gold-lite);letter-spacing:.3px;margin:.2rem 0">ZenTrader Pro</h1>
    <div style="display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-top:12px">
      <select id="voiceSelect" title="Voice"><option>Loading voices‚Ä¶</option></select>
      <button id="testVoice" class="btn" type="button">üîä Test Voice</button>
      <button id="enterApp" class="btn" type="button">Enter Dashboard</button>
    </div>
    <div id="voiceHint" style="margin-top:10px;font-size:12px;color:var(--muted)"></div>
  </div>
</div>

<!-- Header -->
<header class="brand" role="banner">
  <div class="brand-inner">
    <div id="brandLogo" style="display:grid;place-items:center"></div>
    <div class="brand-title">ZenTrader Pro</div>
    <div class="brand-sub">Voice Trading Console ‚Ä¢ v6.0</div>
    <div class="voice" role="group" aria-label="Voice controls">
      <button id="startVoice" class="btn" type="button">üéôÔ∏è Start Voice</button>
      <button id="stopVoice" class="btn" type="button">‚èπÔ∏è Stop</button>
      <span id="voiceStatus" class="status">Idle ‚Äî click Start Voice</span>
    </div>
  </div>
</header>

<!-- Main -->
<main role="main">
  <!-- Trade Entry -->
  <section class="card gold-outline" aria-labelledby="trade-entry">
    <h2 id="trade-entry">Trade Entry</h2>
    <div class="form-grid">
      <label for="ticker">Ticker</label><input id="ticker" placeholder="e.g., SPY, ES, AAPL">
      <label for="side">Direction</label>
      <select id="side"><option value="">‚Äî Select ‚Äî</option><option>Long</option><option>Short</option></select>
      <label for="qty">Quantity</label><input id="qty" type="number" min="0" step="1" placeholder="e.g., 3">
      <label for="entry">Entry Price</label><input id="entry" type="number" min="0" step="0.01" placeholder="e.g., 492.35">
      <label for="exit">Exit Price</label><input id="exit" type="number" min="0" step="0.01" placeholder="e.g., 495.10">
      <label for="result">Win / Loss</label>
      <select id="result"><option value="">‚Äî Select ‚Äî</option><option>Win</option><option>Loss</option><option>BE</option></select>
      <label for="notes">Notes</label><textarea id="notes" placeholder="Reason for entry, setup, management‚Ä¶"></textarea>
    </div>
  </section>

  <!-- KPIs -->
  <section class="card gold-outline" aria-labelledby="kpis">
    <h2 id="kpis">KPIs</h2>
    <div class="stats">
      <div class="stat"><div class="v" id="k1">$0</div><div class="l">PnL (Today)</div></div>
      <div class="stat"><div class="v" id="k2">0%</div><div class="l">Win Rate</div></div>
      <div class="stat"><div class="v" id="k3">0</div><div class="l"># Trades</div></div>
      <div class="stat"><div class="v" id="k4">0.00</div><div class="l">Profit Factor</div></div>
    </div>
  </section>

  <!-- Recent Trades -->
  <section class="card gold-outline" aria-labelledby="recent-trades" style="grid-column:1/-1">
    <h2 id="recent-trades">Recent Trades</h2>
    <table aria-label="Recent trades">
      <thead><tr><th>Date</th><th>Symbol</th><th>Side</th><th>Qty</th><th>Entry</th><th>Exit</th><th>Result</th><th>Notes</th></tr></thead>
      <tbody id="rows"><tr><td>‚Äî</td><td>‚Äî</td><td>‚Äî</td><td>‚Äî</td><td>‚Äî</td><td>‚Äî</td><td>‚Äî</td><td>‚Äî</td></tr></tbody>
    </table>
  </section>

  <!-- Charts -->
  <section class="card gold-outline" aria-labelledby="charts" style="grid-column:1/-1">
    <h2 id="charts">Performance Charts</h2>
    <div class="chart" style="margin-bottom:14px"><canvas id="pnlLine" width="1000" height="260" aria-label="Equity curve"></canvas></div>
    <div class="chart" style="display:grid;grid-template-columns:1fr 1fr;gap:14px">
      <canvas id="winLossDonut" height="240" aria-label="Win/Loss"></canvas>
      <canvas id="pnlBars" height="240" aria-label="Daily PnL"></canvas>
    </div>
  </section>
</main>

<footer role="contentinfo">
  <div id="footerLogo" style="display:grid;place-items:center;margin-bottom:6px"></div>
  <div>¬© ZenTrader Pro</div>
</footer>

<script>
/* ===============================
   Ornate Pirate-Style Logo (SVG)
   ‚Äî lopsided scales: Z low left, cash high right, sunlight from top-left
   Used in splash, header, footer, favicon
   =============================== */
function getOrnateLogoSVG(width){
  const w = width || 800, h = Math.round(w*0.45);
  return `
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 540" width="${w}" height="${h}" role="img" aria-label="ZenTrader Pro ornate golden balance: Z left low, cash right high">
  <defs>
    <linearGradient id="goldGrad" x1="0" x2="0" y1="0" y2="1">
      <stop offset="0%" stop-color="#ffd063"/>
      <stop offset="45%" stop-color="#d4af37"/>
      <stop offset="70%" stop-color="#b88a1c"/>
      <stop offset="100%" stop-color="#7a5e12"/>
    </linearGradient>
    <radialGradient id="shine" cx="0.1" cy="0.1" r="0.9">
      <stop offset="0%" stop-color="#ffffff" stop-opacity="0.55"/>
      <stop offset="40%" stop-color="#ffe08a" stop-opacity="0.25"/>
      <stop offset="100%" stop-color="#000000" stop-opacity="0"/>
    </radialGradient>
    <filter id="drop" x="-50%" y="-50%" width="200%" height="200%">
      <feDropShadow dx="0" dy="8" stdDeviation="8" flood-color="#000000" flood-opacity="0.55"/>
    </filter>
  </defs>

  <!-- Ornate base -->
  <g filter="url(#drop)">
    <path d="M240 480 C 380 430, 820 430, 960 480 L 980 510 C 820 520, 380 520, 220 510 Z"
          fill="url(#goldGrad)" stroke="#b88a1c" stroke-width="4"/>
    <path d="M260 470 C 410 420, 790 420, 940 470" fill="none" stroke="#ffe08a" stroke-opacity=".45" stroke-width="4"/>
    <path d="M240 480 C 380 430, 820 430, 960 480" fill="none" stroke="#7a5e12" stroke-opacity=".6" stroke-width="6"/>
  </g>

  <!-- Center column -->
  <g filter="url(#drop)">
    <rect x="578" y="240" width="44" height="190" rx="10" fill="url(#goldGrad)" stroke="#b88a1c" stroke-width="4"/>
    <circle cx="600" cy="236" r="26" fill="url(#goldGrad)" stroke="#b88a1c" stroke-width="4"/>
  </g>

  <!-- Cross arm (lopsided: left down, right up) -->
  <g filter="url(#drop)">
    <path d="M240 200 L 960 160" stroke="url(#goldGrad)" stroke-width="18" stroke-linecap="round"/>
    <path d="M240 200 L 960 160" stroke="#ffe08a" stroke-opacity=".35" stroke-width="6" stroke-linecap="round"/>
    <path d="M240 200 L 960 160" stroke="#7a5e12" stroke-opacity=".35" stroke-width="3" stroke-linecap="round"/>
  </g>

  <!-- Left chains (low) -->
  <g stroke="url(#goldGrad)" stroke-width="6" filter="url(#drop)">
    <line x1="340" y1="183" x2="340" y2="305"/>
    <line x1="420" y1="180" x2="420" y2="302"/>
    <line x1="380" y1="188" x2="380" y2="308"/>
  </g>

  <!-- Right chains (high) -->
  <g stroke="url(#goldGrad)" stroke-width="6" filter="url(#drop)">
    <line x1="820" y1="169" x2="820" y2="245"/>
    <line x1="880" y1="166" x2="880" y2="242"/>
    <line x1="850" y1="170" x2="850" y2="246"/>
  </g>

  <!-- Left pan (very low) with ornate Z -->
  <g filter="url(#drop)">
    <ellipse cx="380" cy="330" rx="135" ry="26" fill="#000" fill-opacity=".28"/>
    <g transform="translate(280,306)">
      <path d="M0 0 h200 a18 18 0 0 1 18 18 v8 a14 14 0 0 1 -14 14 h-208 a14 14 0 0 1 -14 -14 v-8 a18 18 0 0 1 18 -18z"
            fill="url(#goldGrad)" stroke="#b88a1c" stroke-width="4"/>
      <path d="M-10 10 h220" stroke="#ffe08a" stroke-opacity=".45" stroke-width="4"/>
    </g>
    <g transform="translate(380,300)">
      <circle r="42" fill="url(#goldGrad)" stroke="#b88a1c" stroke-width="4"/>
      <path d="M-20,-18 h40 l-44,36 h48" fill="none" stroke="#1a2233" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M-20,-18 h40 l-44,36 h48" fill="none" stroke="#ffe08a" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" opacity=".85"/>
    </g>
  </g>

  <!-- Right pan (high) with crisp cash stack -->
  <g filter="url(#drop)">
    <ellipse cx="850" cy="270" rx="120" ry="22" fill="#000" fill-opacity=".22"/>
    <g transform="translate(760,246)">
      <path d="M0 0 h180 a16 16 0 0 1 16 16 v6 a12 12 0 0 1 -12 12 h-188 a12 12 0 0 1 -12 -12 v-6 a16 16 0 0 1 16 -16z"
            fill="url(#goldGrad)" stroke="#b88a1c" stroke-width="4"/>
      <path d="M-6 8 h192" stroke="#ffe08a" stroke-opacity=".45" stroke-width="3"/>
    </g>
    <g transform="translate(820,220)">
      <rect x="-58" y="-42" width="116" height="28" rx="4" fill="#4aa564" stroke="#153a25" stroke-width="3"/>
      <rect x="-60" y="-16" width="120" height="28" rx="4" fill="#4aa564" stroke="#153a25" stroke-width="3"/>
      <rect x="-62" y="10"  width="124" height="28" rx="4" fill="#4aa564" stroke="#153a25" stroke-width="3"/>
      <rect x="-18" y="-50" width="36" height="98" fill="#f6f6f6" stroke="#c9c9c9" stroke-width="2"/>
      <rect x="-16" y="-48" width="32" height="94" fill="#ffffff" opacity=".85"/>
    </g>
  </g>

  <!-- Warm sunlight from top-left -->
  <circle cx="0" cy="0" r="500" fill="url(#shine)" />
</svg>`;
}

/* Mount logo everywhere + favicon (SVG data URL) */
function mountLogo(where, width){
  const el = document.querySelector(where);
  if(!el) return;
  el.innerHTML = getOrnateLogoSVG(width);
}
function setFavicon(){
  const svg = getOrnateLogoSVG(256);
  const dataUrl = 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
  const link = document.getElementById('favicon');
  if (link) link.href = dataUrl;
}

/* Demo KPIs/Charts */
const demo = {
  labels:["Mon","Tue","Wed","Thu","Fri","Mon","Tue","Wed","Thu","Fri"],
  pnlCum:[0,300,-120,450,200,680,540,900,750,1200],
  trades:[
    {result:"Win",pnl:220},{result:"Loss",pnl:-80},{result:"Win",pnl:160},
    {result:"Win",pnl:340},{result:"BE",pnl:0},{result:"Win",pnl:180},
    {result:"Loss",pnl:-120},{result:"Win",pnl:260},{result:"Win",pnl:140},
    {result:"Win",pnl:310}
  ]
};
function fmtMoney(v){return(v<0?"-$":"$")+Math.abs(v).toLocaleString()}
function calcKPIs(T){
  const n=T.length,w=T.filter(t=>t.result==="Win"),l=T.filter(t=>t.result==="Loss"),b=T.filter(t=>t.result==="BE");
  const wr=n?Math.round(w.length/n*100):0, tp=T.reduce((s,t)=>s+t.pnl,0);
  const gw=w.reduce((s,t)=>s+t.pnl,0), gl=Math.abs(l.reduce((s,t)=>s+t.pnl,0));
  const pf=gl?gw/gl:(gw?Infinity:0);
  return {n, winRate: wr, totalPnL: tp, profitFactor: pf, wins:w.length, losses:l.length, be:b.length};
}
function updateKPIs(){
  const k=calcKPIs(demo.trades);
  const set=(id,val)=>{const el=document.getElementById(id); if(el) el.textContent=val;};
  set('k1',fmtMoney(k.totalPnL)); set('k2',k.winRate+'%'); set('k3',k.n); set('k4',(Math.round(k.profitFactor*100)/100).toFixed(2));
}

/* Canvas charts (no libs) */
function grid(x,x1,y1,x2,y2,s){x.strokeStyle='rgba(255,255,255,0.06)';x.lineWidth=1;for(let i=0;i<=s;i++){const y=y1+(y2-y1)*(i/s);x.beginPath();x.moveTo(x1,y);x.lineTo(x2,y);x.stroke();}}
function drawLine(c,labels,data){const x=c.getContext('2d'),W=c.width,H=c.height;x.fillStyle='#0e1524';x.fillRect(0,0,W,H);const p={l:50,r:12,t:18,b:34},w=W-p.l-p.r,h=H-p.t-p.b;const M=Math.max(...data,0),m=Math.min(...data,0),R=(M-m)||1,y=v=>p.t+h-((v-m)/R)*h;grid(x,p.l,p.t,W-p.r,p.t+h,4);x.strokeStyle='#ffe08a';x.lineWidth=2;x.beginPath();data.forEach((v,i)=>{const X=p.l+w/(data.length-1)*i,Y=y(v);i?x.lineTo(X,Y):x.moveTo(X,Y)});x.stroke();x.fillStyle='#d4af37';data.forEach((v,i)=>{const X=p.l+w/(data.length-1)*i,Y=y(v);x.beginPath();x.arc(X,Y,3,0,6.283);x.fill()});x.fillStyle='#9db0c8';x.font='11px system-ui,-apple-system,Segoe UI,Roboto,Arial';x.fillText('PnL',8,16);x.fillText('Time ‚Üí',W/2-20,H-8)}
function drawBars(c,labels,cum){const x=c.getContext('2d'),W=c.width,H=c.height;x.fillStyle='#0e1524';x.fillRect(0,0,W,H);const p={l:40,r:12,t:14,b:34},w=W-p.l-p.r,h=H-p.t-p.b;const d=cum.map((v,i)=>i===0?v:cum[i]-cum[i-1]);const M=Math.max(...d,0),m=Math.min(...d,0),R=(M-m)||1,y=v=>p.t+h-((v-m)/R)*h,bw=w/d.length*.7;grid(x,p.l,p.t,W-p.r,p.t+h,4);d.forEach((v,i)=>{const X=p.l+w/d.length*i+(w/d.length-bw)/2,Y=y(v),Y0=y(0);x.fillStyle=v>=0?'rgba(63,179,127,.75)':'rgba(212,91,107,.75)';x.fillRect(X,Math.min(Y,Y0),bw,Math.abs(Y-Y0));x.strokeStyle=v>=0?'#3fb37f':'#d45b6b';x.strokeRect(X,Math.min(Y,Y0),bw,Math.abs(Y-Y0))});x.fillStyle='#9db0c8';x.font='11px system-ui,-apple-system,Segoe UI,Roboto,Arial';x.fillText('Daily PnL',8,16);x.fillText('Time ‚Üí',W/2-20,H-8)}
function drawDonut(c,w,l,b){const x=c.getContext('2d'),W=c.width,H=c.height;x.fillStyle='#0e1524';x.fillRect(0,0,W,H);const cx=W/2,cy=H/2,r=Math.min(W,H)/2-16,i=r*.6,t=w+l+b||1,P=[{v:w,color:'#3fb37f',label:'Wins'},{v:l,color:'#d45b6b',label:'Losses'},{v:b,color:'#9db0c8',label:'BE'}];let a=-Math.PI/2;P.forEach(p=>{const a1=a+(p.v/t)*Math.PI*2;x.beginPath();x.moveTo(cx,cy);x.arc(cx,cy,r,a,a1);x.closePath();x.fillStyle=p.color;x.fill();a=a1});x.globalCompositeOperation='destination-out';x.beginPath();x.arc(cx,cy,i,0,6.283);x.fill();x.globalCompositeOperation='source-over';x.font='12px system-ui,-apple-system,Segoe UI,Roboto,Arial';x.fillStyle='#e8eef7';let ly=H-10,lx=10;P.forEach(p=>{x.fillStyle=p.color;x.fillRect(lx,ly-10,10,10);x.fillStyle='#e8eef7';x.fillText(p.label+': '+p.v,lx+16,ly);ly-=16})}
function renderAll(){updateKPIs();drawLine(document.getElementById('pnlLine'),demo.labels,demo.pnlCum);drawBars(document.getElementById('pnlBars'),demo.labels,demo.pnlCum);const k=calcKPIs(demo.trades);drawDonut(document.getElementById('winLossDonut'),k.wins,k.losses,k.be)}

/* Voice (robust loader + fallbacks) */
const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
const synth = window.speechSynthesis;
const voiceSelect = document.getElementById('voiceSelect');
const testVoiceBtn = document.getElementById('testVoice');
const enterBtn = document.getElementById('enterApp');
const voiceHint = document.getElementById('voiceHint');
const statusEl = document.getElementById('voiceStatus');
const btnStart = document.getElementById('startVoice');
const btnStop  = document.getElementById('stopVoice');

function rankVoice(v){let s=0;if(/en-GB/i.test(v.lang))s+=1000;if(/female/i.test(v.name))s+=200;if(/Google|Microsoft|Apple/i.test(v.name))s+=50;if(/(Libby|Sonia|Hazel|Amy|Emma|Charlotte|Ellie|Mia|Aria|Jane|Lucy|Serena)/i.test(v.name))s+=120;return s;}
let voicesLoaded=false;
function populateVoices(){
  const voices=synth?.getVoices()||[];
  if(!voices.length){setTimeout(populateVoices,250);return;}
  voicesLoaded=true;
  const sorted=voices.slice().sort((a,b)=>rankVoice(b)-rankVoice(a));
  voiceSelect.innerHTML="";
  sorted.forEach(v=>{const opt=document.createElement('option');opt.value=v.name;opt.textContent=`${v.name} (${v.lang})`;voiceSelect.appendChild(opt);});
  if(sorted.length) voiceSelect.value=sorted[0].name;
  voiceHint.textContent='Tip: choose a voice (British female preferred).';
}
if(typeof speechSynthesis!=='undefined' && speechSynthesis.onvoiceschanged!==undefined){speechSynthesis.onvoiceschanged=populateVoices;}
populateVoices();

function currentVoice(){const name=voiceSelect?.value;const list=synth?.getVoices()||[];return list.find(v=>v.name===name)||list[0]||null;}
function speak(text){
  try{const u=new SpeechSynthesisUtterance(text);const v=currentVoice();if(v)u.voice=v;u.rate=1.0;u.pitch=1.0;u.volume=1.0;synth.speak(u);}catch(e){console.warn('TTS error',e);}
}
testVoiceBtn.addEventListener('click',()=>{if(!voicesLoaded)populateVoices();speak("Hello. This is the ZenTrader Pro assistant, speaking with a British accent if available.");});
enterBtn.addEventListener('click',()=>{document.getElementById('splash').classList.add('hidden');speak("Welcome to ZenTrader Pro.");});

/* Speech recognition (manual start) */
let rec=null,listening=false,armed=false;
if(SR){rec=new SR();rec.lang='en-US';rec.continuous=true;rec.interimResults=true;
  rec.onresult=(e)=>{let finalText='';for(let i=e.resultIndex;i<e.results.length;i++){const r=e.results[i],txt=r[0].transcript.trim();if(r.isFinal)finalText+=' '+txt;}
    if(!finalText)return;const low=finalText.toLowerCase();
    if(!armed && (/\bhey\s+then\b/.test(low)||/\bhey\s+zen\b/.test(low))){armed=true;speak("Yes, I'm listening.");statusEl.textContent='Awake. Say a command‚Ä¶ e.g., ‚Äúticker AAPL quantity 3 entry 492 point 35‚Äù';return;}
    if(armed){handleCommand(finalText);}
  };
  rec.onstart=()=>{listening=true;statusEl.textContent='Listening‚Ä¶ Say ‚Äúhey then‚Äù or ‚Äúhey zen‚Äù‚Ä¶';};
  rec.onend=()=>{listening=false;statusEl.textContent='Stopped. Click Start Voice to resume.';};
}
btnStart.addEventListener('click',()=>{if(!rec){statusEl.textContent='Speech recognition not supported in this browser.';return;}try{if(!listening)rec.start();}catch(_){}}); 
btnStop.addEventListener('click',()=>{if(!rec)return;armed=false;try{rec.stop();}catch(_){}});

/* Parse commands -> form + readback */
function handleCommand(t){
  const s=t.toLowerCase();
  const tm=s.match(/\b(ticker|symbol)\s+([a-z]{1,5})\b/); if(tm) document.getElementById('ticker').value=tm[2].toUpperCase();
  if(/\b(long|buy)\b/.test(s))  document.getElementById('side').value='Long';
  if(/\b(short|sell)\b/.test(s)) document.getElementById('side').value='Short';
  const qm=s.match(/\b(quantity|qty)\s+(\d{1,6})\b/); if(qm) document.getElementById('qty').value=qm[2];
  const numFrom = q => parseFloat(q.replace(/point/gi,'.').replace(/[^\d.]/g,''));
  const em=s.match(/\b(entry|enter|at)\s+(\d+(\s*point\s*\d+)?)\b/); if(em) document.getElementById('entry').value=numFrom(em[2]);
  const xm=s.match(/\b(exit|target|take\s*profit)\s+(\d+(\s*point\s*\d+)?)\b/); if(xm) document.getElementById('exit').value=numFrom(xm[2]);
  const nm=s.match(/\bnotes?\s+(.*)$/); if(nm) document.getElementById('notes').value=nm[1];
  if(/\b(read\s*back|confirm|repeat)\b/.test(s)){
    const out={ticker:document.getElementById('ticker').value||'‚Äî',side:document.getElementById('side').value||'‚Äî',qty:document.getElementById('qty').value||'‚Äî',entry:document.getElementById('entry').value||'‚Äî',exit:document.getElementById('exit').value||'‚Äî'};
    speak(`Ticker ${out.ticker}. Direction ${out.side}. Quantity ${out.qty}. Entry ${out.entry}. Exit ${out.exit}.`);
  }
}

/* Header spacing fix so content never hides under it */
function fixHeaderPadding(){
  const header = document.querySelector('header.brand');
  if(!header) return;
  const h = Math.ceil(header.getBoundingClientRect().height);
  document.body.style.paddingTop = h + 'px';
}
window.addEventListener('resize', fixHeaderPadding);
window.addEventListener('load', fixHeaderPadding);

/* Mount logos + favicon and render charts/KPIs */
function initBranding(){
  const mount = (sel,w)=>{ const el=document.querySelector(sel); if(el) el.innerHTML = getOrnateLogoSVG(w); };
  mount('#splashLogo', 560);
  mount('#brandLogo', 560);
  mount('#footerLogo', 280);
  const svg = getOrnateLogoSVG(256);
  document.getElementById('favicon').href = 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
}
function init(){
  initBranding();
  fixHeaderPadding();
  renderAll();
}
if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',init);}else{init();}
</script>
</body>
</html>
	


	

	

	

	

	

	
